ありがとうございます。以下の条件に基づいて、Cardano モバイルウォレットとの P2P 接続（CIP-45）の技術的実現性、代替案、導入戦略などを包括的に調査します。

調査が完了次第、技術分析・段階的導入計画・推奨戦略・代替案評価を日本語でご報告します。しばらくお待ちください。

# Cardano モバイル dApp-ウォレット P2P 接続の実現可能性分析

## CIP-45 実装の実現可能性

**CIP-45 の概要と利点:** CIP-45（別名「Cardano Connect」）は、WebRTC と WebTorrent トラッカーを用いたモバイル dApp とウォレット間のピアツーピア接続標準です。従来、モバイル環境ではウォレットと dApp 間の直接通信が難しく、Universal Link や Deep Link 経由で制限的なデータ受け渡ししかできませんでした。WalletConnect のような一般的ソリューションは WebRTC を利用しますが、集中型のシグナリングサーバ（リレーサーバ）を必要とし、単一点障害（SPOF）のリスクがあります。CIP-45 はこの中央サーバを不要にするため、**WebTorrent のトラッカーネットワークを使った分散型ピア発見**によって WebRTC 接続を確立します。接続後はウォレットの RPC 機能（CIP-30 API）を dApp 側のグローバルオブジェクト（`window.cardano`）にインジェクトし、デスクトップ環境と同様の API 経由で UTxO 取得やトランザクション署名を実行できるようにします。Cardano 財団も CIP-45 を\*\*「プライバシー保護かつ信頼性の高い完全分散型通信」\*\*として位置づけ、2023 年の公式投票アプリで Eternl ウォレットを用いた CIP-45 接続を実証しています。

**実装の複雑さと見積もり:** 開発面では、Fabian Bormann 氏らによる公式ライブラリ「**cardano-peer-connect**」が公開されており、これを利用することで CIP-45 対応を比較的シンプルに組み込めます。同ライブラリには dApp 側用の`DAppPeerConnect`クラスとウォレット側用の`CardanoPeerConnect`クラスが提供され、CIP-30 の全メソッドを P2P 経由で呼び出す仕組みが実装済みです。dApp 側では数行のコードでユニークな接続識別子（public key ベース）を生成し、QR コード表示や Universal Link 経由でウォレットに渡すことができます。ウォレット側では識別子を受け取り、トラッカーリストに問い合わせて P2P 接続を確立、以降は dApp からの要求に応じて CIP-30 API 処理を行います。基本的な通信処理はライブラリが担うため、**実装自体の難易度は中程度**と考えられます。2〜4 週間の開発期間で、主要ウォレット（Yoroi や Eternl）との接続・UTxO 取得・トランザクション署名フローの MVP 実装は概ね可能でしょう。実際、CIP-45 は 2022 年末に提案されて以降、2023 年にはエコシステムで試験導入が進み、Cardano 財団もオープンソースの接続コンポーネント開発を進めていました。これらの動向から、**2〜4 週間での実装は比較的現実的**と判断できます。

**ウォレット側の対応状況:** 現在、モバイル対応ウォレットの中で**Eternl**は CIP-45（CardanoConnect）に公式対応済みです。同ウォレットは v1.11.0 で「_CardanoConnect (CIP-45)による分散型接続_」を実装し、dApp からの P2P 接続を受け付けられるようになっています。また Eternl は WalletConnect にも対応し、**「あらゆる接続方法をサポート」**とうたっており、モバイル dApp 接続の主力機能として CIP-45 を位置付けています。**Yoroi**については、公式にモバイル dApp コネクタ機能の提供を予告しており、2024 年末〜2025 年初頭にかけてリリースが近いとされています。Yoroi チームは「WalletConnect は使用せず、最も安全でエレガントな解決策を準備中」とコメントしており、これは事実上 CIP-45 準拠の独自実装である可能性が高いです。**Flint**や**GeroWallet**、**Tokeo**など他のモバイルウォレットについては現時点で公式な CIP-45 対応発表は見当たりません。しかし、Eternl や Yoroi が牽引する形で今後対応が広がる可能性があります。Eternl の呼びかけでも「全ての dApp に CardanoConnect の実装を推奨」するとあり、エコシステム全体でこの流れを標準化しようとしています。

**ブラウザ互換性:** CIP-45 方式は、基本的に**iOS Safari**および**Android Chrome**といった主要モバイルブラウザ上で動作します。WebRTC と WebSocket(WebTorrent)が必要となりますが、iOS 11 以降の Safari およびモダンな Android Chrome であればこれらは標準サポートされています。Cardano Ballot の実証では iOS/Android 双方で Eternl ウォレットを用いた接続が機能しており、技術的には主要ブラウザで動くことが確認されています。従って、**ブラウザ互換性は概ね問題ありません**。ただし、各ブラウザのバックグラウンド制限（特に iOS の Safari が非アクティブ時に WebRTC 通信を維持できる時間など）については留意が必要です。これらは次節で詳述します。

**プロダクション用途の安定性:** CIP-45 は現在「Active」ステータスの提案であり、Cardano コミュニティで既にテスト実装が存在します。中央サーバ不要のメリットがある一方、安定運用には**シグナリング手段（トラッカー）の信頼性**が鍵となります。標準実装では WebTorrent のパブリックトラッカー（例: `wss://tracker.openwebtorrent.com` など複数）を利用します。パブリックトラッカーは無料で利用できますが稼働状況が不安定な場合もあり、企業向けプロダクション環境でそのまま使うにはリスクがあります。対策としては複数トラッカーを併用する、または自前で信頼性の高い WebRTC シグナリングサーバ（もしくは WebTorrent 互換トラッカー）を構築して使用する方法があります。CIP-45 自体はトラッカー種別を問いませんので、必要に応じてパブリックからプライベートへ切り替えることも可能です。現段階の実運用例（Cardano Ballot など）では、大きな問題は報告されておらず\*\*「信頼性は実証済み」とする見解もあります\*\*。もっとも、新しい標準ゆえに予期せぬ不具合（接続できないケースや一部端末での問題）が残っている可能性は否定できません。実装にあたっては後述のリスク緩和策を講じ、十分なテスト期間を確保することで、プロダクションレベルでの安定性を担保できるでしょう。

> **実現可能性評価:** B（高い可能性で実現可能）
> **想定工数:** 約 15 ～ 20 人日（2 ～ 4 週間で 1 ～ 2 人のエンジニアによる開発・テスト）
> **主なリスク要因:** トラッカー依存による接続不良、モバイル OS のバックグラウンド制限、対応ウォレットの限定
> **成功確率:** 約 80%（適切な対策とテストにより高い成功率が見込まれる）

## モバイル P2P 接続の信頼性

**アプリ切替時の接続維持:** モバイル環境最大の課題は、ユーザーがブラウザ（dApp）とウォレットアプリを行き来する際に**P2P 接続が維持されるか**という点です。WebRTC のデータチャネルによる接続は、一方のピアがバックグラウンドに回ってもしばらくは維持される設計ですが、モバイル OS の制約により長時間の維持は保証されません。特に iOS では、バックグラウンドでのソケット通信は厳しく制限され、ウォレットがバックグラウンドに移行すると一定時間で通信が休止・切断される恐れがあります。実装側で考慮すべきは以下の点です:

- **短時間のバックグラウンド:** ユーザーがウォレットを開いてからすぐブラウザに戻る程度の短時間（数秒～数十秒）であれば、接続は維持され**シームレスに RPC 呼び出しが可能**と期待されます。Android では比較的緩やかで、実験によればバックグラウンドでも一定時間データ受信が可能とのことです（CIP 議論中にも「Android でバックグラウンド動作を検証する」旨が言及されています）。一方 iOS ではバックグラウンド遷移後の動作は限定的で、長時間離れると接続断となる可能性が高いです。
- **長時間・スリープの場合:** ユーザーがウォレットアプリ上で操作（例: トランザクション確認作業など）に時間をかけたり、デバイスをスリープさせたりすると、その間に WebRTC セッションがタイムアウトするリスクがあります。これに対処するため、**一定時間ごとの接続ヘルスチェック**や**再接続ロジック**を実装しておくことが望ましいです。たとえば、ブラウザ側`DAppPeerConnect`で定期的に ping を送りウォレットからの応答を確認し、反応が無ければユーザーに再接続を促す、といった仕組みです。
- **再接続シーケンス:** 接続が途切れた場合でも、CIP-45 では\*\*同一の識別子(seed)\*\*を使えば再度同じウォレットとピア発見をやり直すことが可能です。ユーザー体験としては、一度目の接続フローを繰り返す形になりますが、**自動再接続**を試みる実装も検討できます。例えば dApp 側がウォレット識別子を保持しておき、接続ロスト検知時に自動で再度`connect()`を呼び出す、といった対応です。ただしユーザーの明示的許可なく自動再接続することにはセキュリティ上注意が必要であり、ウォレット側でも再接続要求時に再度許可確認が入る可能性があります。

**UTxO/残高同期の確実性:** P2P 接続を通じてウォレットから UTxO や残高情報を取得する際の信頼性は、基本的に**ウォレットがオープンして最新状態に同期されている**ことに依存します。ユーザーがウォレットアプリを起動した直後であれば、その時点のチェーン同期（ライトウォレットならバックエンドサーバから最新 UTxO セット取得）が行われます。CIP-45 経由の`api.getUtxos()`や`api.getBalance()`呼び出しに対し、ウォレットは最新の情報を返す設計です（※Yoroi 開発者によるモバイル連携の代替案でも、バックエンド API を用いて残高取得・署名する例が示されています）。したがって**通信層が安定していれば UTxO/残高の取得精度自体は高い**と考えられます。むしろ問題は、その**通信路が中断なく双方向データをやり取りできるか**にかかっています。

- **リアルタイム性:** WebRTC データチャネルのレイテンシは非常に低く、中央サーバ中継を挟まないためウォレットと dApp 間の通信はほぼ即時に行われます。ユーザーがブラウザに戻って「残高更新」ボタンを押す等のアクションをすれば、その瞬時にウォレットから最新残高が返るでしょう。CardanoConnect を実装した Eternl も、Socket 通信ベースのリアルタイム同期機能を試みた経緯があります（※ただし一部ユーザーで不具合が出たため HTTP ポーリングに戻したとの記載あり）。CIP-45 自体はソケット常時接続ではなく**リクエスト/レスポンス型**ですが、通信確立後は擬似的にリアルタイムなクエリが可能です。
- **データの正確性:** ウォレットが返す UTxO や残高データは、基本的にウォレット内部のステートに依存します。ユーザーが最後に同期したブロックまでの情報となるため、もしユーザーが長時間ウォレットを開いておらずブロック情報が遅れている場合、取得結果も遅延します。この点、実用上はユーザーがウォレットを起動したタイミングで最新まで同期されるはずなので大きな問題にはなりにくいでしょう。また、取引を実行した場合には、一時的に残高に変化が生じますが、dApp 側でトランザクション送信後に再度`getUtxos()`や`getBalance()`を呼ぶことで**最新状態を反映**できます。Eternl などは、CIP-30 の`submitTx`経由でトランザクションを送信すると UI 上で即残高更新する工夫も入れており、dApp にもウォレット経由送信を推奨しています。P2P 接続中にウォレットが新たな UTxO を受信した場合などの**プッシュ通知的同期**は CIP-45 単体では規定されていないため、必要に応じ dApp 側でポーリングすることになりますが、通常の dApp-ブラウザウォレット間と同様の扱いです。

**接続失敗時のリカバリ:** WebRTC 接続が確立しない、あるいは途中で切れた場合のエラーハンドリングが重要です。考えられるケースごとに以下の対策が必要です:

- **初期接続失敗:** ユーザーがウォレットアプリを起動したが、何らかの理由で P2P リンクが張れない場合（例: トラッカーへの到達不可、ウォレットが CIP-45 非対応、ユーザーが許可を拒否した等）。この場合、ブラウザ側では一定時間内に`onApiInject`が呼ばれないことを検知し、ユーザーに「接続に失敗しました。再試行してください。」と通知します。再試行ボタンを用意し、再度ウォレット起動（識別子を再生成するか同じものを再利用）を促す実装が望ましいです。加えて、ウォレットが CIP-45 未対応だった場合は永遠に成功しないため、タイムアウトエラー時には\*\*「お使いのウォレットはこの接続方式に未対応の可能性」\*\*を警告し、別ウォレットの使用を案内することも検討します。
- **通信途絶・タイムアウト:** 接続後、dApp からの RPC 呼び出しにウォレットが応答しない場合、一定時間待ってエラーを throw し、ユーザーに接続維持の問題を伝えます。例えば「ウォレットとの通信が途切れました。ウォレットアプリを前面に開き直してから再度お試しください。」等のメッセージで対処を促します。技術的には`DAppPeerConnect`側で RPC コールごとにタイムアウトを設定し、未応答なら`disconnect()`処理と UI 通知を行うと良いでしょう。
- **部分的なデータ不整合:** 稀にウォレットが不完全なデータを返したり（例: UTxO リストの一部欠落）、dApp 側のシリアライズに失敗する可能性も考えられます。その場合、単純にもう一度 API 呼び出しをリトライする戦略が取れます。UTxO 取得に失敗したら自動で数秒後に再取得、などユーザー操作なしのリトライも有効です。それでもダメなら一旦接続解除して再接続フローを促す方が確実でしょう。

以上のように、モバイル特有の切断リスクはありますが、**適切なタイムアウト・再試行ロジックと UI でのユーザー案内**により、ユーザー体験を大きく損ねずに運用できると考えられます。特に初回接続時と署名要求時の 2 つの山場でユーザーをしっかり誘導することが信頼性確保のポイントです（具体的な UX 改善策は後述のリスク軽減策で提案します）。

## ウォレットエコシステムとの互換性

**主要ウォレットの対応状況:** 現時点でモバイル dApp 連携に直接対応しているウォレットと、その方式は以下の通りです:

- **Eternl:** _対応方式: CIP-30（拡張機能/組込ブラウザ）, CIP-45（CardanoConnect）, WalletConnect_
  Cardano コミュニティ主導のライトウォレット。モバイルアプリ(iOS/Android)には**内蔵の DApp ブラウザ**があり、アプリ内から dApp サイトを開くと自動的に API が注入され接続されます。さらに v1.11.0 よりアプリ外ブラウザとの連携として CIP-45 P2P 接続をサポートし、外部 Safari/Chrome で開いた dApp とも接続可能です。加えて WalletConnect にも独自対応しており、複数の手段を併用できます。Eternl は現在**CardanoConnect と WalletConnect を公式に推奨**しており、エコシステムで最も積極的にモバイル連携を支えているウォレットと言えます。

- **Yoroi:** _対応方式: （モバイル dApp コネクタ開発中）, CIP-30（ブラウザ拡張）_
  EMURGO 社の公式ライトウォレット。デスクトップ（ブラウザ拡張）では CIP-30 対応済みですが、モバイルアプリには dApp ブラウザがなく、長らく外部 dApp と接続できない状態でした。2024 年時点で**モバイル dApp コネクタ機能を実装中**と公表されており、WalletConnect は採用せず独自安全な方式を取ると述べています。おそらく CIP-45 に準拠した P2P 接続になると推測され、近い将来 Yoroi でも CardanoConnect が利用可能になる見込みです。Yoroi はユーザー数が多いため、この対応がリリースされればモバイル dApp 利用範囲が一気に広がるでしょう。

- **Flint:** _対応方式: アプリ内 DApp ブラウザ_
  dcSpark 社のマルチチェーン対応ウォレット。Flint はモバイルアプリ内にブラウザを備え、**「モバイルで多様な dApp に接続可能」と公式に謳っています**。実際には Flint アプリ内で dApp の URL を開き、CIP-30 API を注入して利用する形です。つまり Flint の場合、ユーザーは Safari/Chrome ではなく Flint 内ブラウザを使う必要があります。CIP-45 など外部ブラウザ連携については公表されていません。Flint は EVM チェーンも扱うため WalletConnect プロトコルには精通していますが、Cardano 固有にはまだの様子です。

- **GeroWallet:** _対応方式: （未対応/不明）_
  DeFi 志向のウォレットで、一応 iOS/Android アプリがあります。ただモバイル dApp 接続に関する情報はなく、現状ではブラウザ拡張（デスクトップ）中心と思われます。CIP-45 対応の発表も特に確認できませんでした。

- **Tokeo:** _対応方式: （未対応/不明）_
  新興のクロスチェーン対応ウォレット。カードアノコミュニティで注目されていますが、dApp 接続について公式サイト等に記載が見当たりません。CIP-45 キーワードにも言及がなく、現状は未対応と推測されます。

- **その他（Typhon, Lace, Nami, Daedalus など）:** これらは**モバイルアプリ自体が存在しない**か未リリースのため対象外です。Typhon や Nami はブラウザ拡張のみ、Daedalus はデスクトップ専用、Lace は現状デスクトップのみです（将来モバイル版計画あり）。従ってモバイル dApp 接続の検討対象からは外します。

**対応ウォレットに合わせた戦略:** 上記より、当面注力すべきは**Yoroi と Eternl**の 2 大ウォレットです。この二つがユーザー数・知名度ともに高く、片方（Eternl）は既に実用可能、もう片方（Yoroi）も実現間近です。MVP 段階では **Eternl** による CIP-45 接続をまずサポートし、次いで Yoroi 対応版が出次第追加サポートする方針が現実的です。Eternl 向け実装は他ウォレット（例えば Flint や Gero）が追随した場合にも転用しやすく、CardanoConnect 共通仕様に沿っています。一方、**Flint ユーザーへの対応**も考慮が必要です。Flint が CIP-45 未対応である間、Flint ユーザーには「Flint アプリ内の dApp ブラウザで本サービスをご利用ください」と案内するのが無難かもしれません（Flint 公式もその方法を推奨しています）。Eternl も同様に内蔵ブラウザを提供していますが、CardanoConnect 対応済みなので外部ブラウザ利用を促せます。**WalletConnect**への直接対応は、Cardano 版が標準化されていない現状では難しいですが、Eternl が WalletConnect 互換の接続を提供しているため、理論上は dApp 側で WalletConnect クライアント実装を組み込めば Eternl と通信できる可能性があります。ただしその場合も**結局対応ウォレットは Eternl 限定**であり、メリットが少ないため、優先度は低いでしょう。

**エコシステム全体への配慮:** Cardano におけるモバイル dApp 接続は黎明期であり、ユーザーや開発者への教育・周知も重要です。例えば、あるウォレットで接続不具合が起きた場合、それがウォレット非対応なのか一時的な通信不良なのかユーザーには判別がつきません。dApp 側でウォレット選択 UI に\*\*「(Beta)」「(推奨)」\*\*等のラベルを付与し、現時点で安定している接続手段を示すと親切です。Eternl と Yoroi は「モバイル対応」バッジを付ける、Flint 等は「内蔵ブラウザで利用」と注記する、といった工夫が考えられます。また、CIP-45 という技術名称自体はユーザーには難解なので、「Cardano Connect」や単に「モバイル接続」のような一般用語で案内し、エコシステム共通の呼称に合わせるのが望ましいです（Eternl も「CardanoConnect」というユーザー向け表記を使用）。

今後ウォレット側のアップデートで新方式（例えば公式な WalletConnect v2 対応や、新しい CIP の登場）があれば柔軟に追随する必要がありますが、**現状では CIP-45 が事実上の標準**となりつつあるため、この方針に沿って実装を進めるのが最適と判断します。

## 代替アプローチの評価

CIP-45 以外にも考えられるモバイル接続手段を検討し、それぞれのメリット・デメリットを評価します。

- **① WalletConnect（カード版）** – _「Ethereum 等で一般的な WalletConnect を Cardano に応用」_
  **Pros:** 実績ある UX（QR コードや Deep Link で接続）、既存の WalletConnect インフラやマルチチェーン対応を活用可能。中央サーバ経由のため接続安定性が高く、モバイルバックグラウンド問題もサーバが吸収します。また複数デバイス間（PC とスマホなど）の接続にも強み。
  **Cons:** **中央集権的**であり、サーバダウン時に接続不能となる SPOF 問題があります。また現時点で Cardano 用チェーン ID や TX 仕様が標準化されておらず、独自実装が必要です。エコシステムとしても CIP-45 という非集中型の標準を採用しようとしている時期に、逆行する形で中央サーバ方式を導入するのは好ましくありません。WalletConnect クライアント/サーバを自前運用するとしても、その構築・維持コストが発生し、本来不要なインフラ依存を抱え込むことになります。
  **Effort:** 中程度～高。WalletConnect v2 の仕様調査と Cardano TX メッセージカスタム実装が必要。数週間以上の開発とテスト、サーバ運用体制の整備が必要。

- **② カスタム集中サーバ方式** – _「簡易版 WalletConnect: 独自サーバで dApp とウォレットの通信を仲介」_
  **Pros:** プロトコルを自前で設計すればシンプルな API で実現でき、既存技術(WebSocket や HTTP)で構築可能です。ウォレットと dApp が双方自社サービス内であれば REST API 経由で直接残高取得・署名させることもできます（カードウォレットのバックエンドを流用）。**通信の安定性**はサーバ管理下で保証しやすく、エンドツーエンドで制御できます。
  **Cons:** **セキュリティと信頼性の責任が全てサーバ側に集中**します。ユーザーのトランザクションやアドレス情報がサーバ経由となり、秘密鍵そのものは渡さなくとも中継サーバが改ざん・漏洩のリスク点となります。また特定のウォレットに特化した実装になりがちで、汎用性・相互運用性に欠けます。複数ウォレット対応するには各社 API と連携するカスタムコードが必要となり拡張性も低いです。結果的に WalletConnect を独自にゼロから作るような手間となるでしょう。**中央サーバへの依存**は WalletConnect と同様の単一点障害リスク・検閲リスクも孕みます。
  **Effort:** 中程度。自前で WebSocket サーバや Polling 機構を作る実装時間はそれほど多くないかもしれませんが、安全性の検証や各ウォレットとの連携調整に工数を要します。2 ～ 4 週間で拙速に構築すると不具合時のトラブルシュートが難しく、長期的な負債となる恐れがあります。

- **③ ハイブリッド方式** – _「CIP-45 + 他技術の組合せで弱点補完」_
  **Pros:** CIP-45 を基本としつつ、**シグナリング部分だけカスタム**するなどの組合せが考えられます。例えば WebTorrent トラッカーではなく**自前のシグナリングサーバを CIP-45 用に用意**し、WebRTC 接続自体は P2P で行う案です。これにより SPOF リスクは若干上がるものの、公開トラッカーの不安定さは解消され安定接続を提供できます。また**デバイス間で Deep Link + ブリッジサーバ**を使う方法もあります。例えば dApp が生成した識別子を独自サーバ DB に保存し、Deep Link でウォレットを開く際にその ID を付与、ウォレットはサーバ経由で dApp を見つけに行く――といった流れです。通信本流は依然 WebRTC P2P なので、中央サーバは最小限の役割（出会い系）に留められます。
  **Cons:** アーキテクチャが複雑化し、**ハイブリッドゆえのバグ要因**が増えます。例えば自前シグナリングが落ちれば WalletConnect 同様に接続不能ですし、二重の仕組みを整えるコストも高いです。トラッカーと自前サーバ両方を実装すれば冗長性は上がりますが、その検証・維持は負担です。また複数技術の組合せはデバッグが難しく、問題発生時に原因が追跡しづらいという側面もあります。総じて、メリットがデメリットを上回るかはケースバイケースです。
  **Effort:** 高。CIP-45 実装に加えてサーバ開発・二重のテストが必要となり、4 週間以上の見積りとなります。

- **④ カスタム Deep Link プロトコル** – _「Deep Link の往復で必要情報をやり取り」_
  **Pros:** 最もシンプルに中央サーバも P2P も使わない方法として、Deep Link（または Universal Link）の呼び出しにクエリパラメータ等でデータを載せ、ウォレットが処理後に別の Link でブラウザに戻す方式が考えられます。例えば「`<ウォレットスキーム>://signTx?tx=<txHex>&callbackURL=<dAppURL>`」のようなリンクを定義し、ウォレットが署名完了後`callbackURL`に署名結果を付与してブラウザを開く、などです。これなら**1 回の操作ごとに都度ユーザーが遷移する形にはなりますが、確実にデータを受け渡し**できます。OS 標準の機能のみで完結するため、新たなライブラリ依存もありません。
  **Cons:** **標準化されておらずウォレットごとに仕様が異なる**ため、実装・サポートが困難です。現状、Cardano の主要ウォレットでこうしたカスタム URI スキームを公開している例はほぼありません（過去に限定的な実装が議論された程度）。また、連携ごとにユーザーが毎回往復する必要があり UX は大きく損なわれます。例えば残高確認でウォレットアプリへ移動 → 戻る、トランザクション作成でまた移動 → 戻る、と都度画面遷移が発生し、現実的な利用には耐えないでしょう。安全性の面でも、パラメータ経由で TX を渡す際のエンコード/長さ制限や URL スキームの脆弱性などクリアすべき課題があります。
  **Effort:** 中程度（各ウォレットの URI ハンドラ実装調査・個別対応が必要）。しかし**実用性に疑問**が残るため、労力に見合わない可能性が高いです。

- **⑤ dApp 組み込みウォレット（特殊ケース）** – _「dApp 側で簡易ウォレットを内包する」_
  **Pros:** 例えば、dApp 自体がユーザーのシードフレーズを受け入れ、その場でトランザクションを生成・署名してしまう方法です。あるいはユーザーにローカルに`cardano-wallet`ライト版を動かしてもらい、その API を叩く方法も考えられます。この場合、他システムとの連携不要で完全に自己完結できます。ネットワーク不調も関係なく、常に確実に UTxO や署名を取得できます。
  **Cons:** **セキュリティリスクが極めて高く推奨不可**です。ユーザーの秘密鍵を dApp 側（ブラウザ）で扱うことになり、フィッシングや漏洩の危険があります。また開発も実質ウォレットアプリを一から作るようなもので、多大なコストがかかります。Cardano の UTxO 管理やシリアライズは複雑で、既存ウォレットに任せるべき領域です。本プロジェクトの制約（「秘密鍵の露出なし」）にも反するため、この手法は比較検討上挙げるに留め、**採用すべきではありません**。

以上を踏まえると、**最有力のアプローチは CIP-45**であり、次点も特に有望な代替はありません。WalletConnect は中央集権的で Cardano では標準外、カスタムサーバも長期的負債、Deep Link 往復はユーザー体験劣悪、となれば、現状 CIP-45 採用が最もバランスが取れています。Eternl や Yoroi も CIP-45 方向で動いていることから、エコシステムの合意もこちらに傾いています。従って本分析では**CIP-45 実装を主軸**とし、必要に応じてハイブリッド方式（自前トラッカー追加など）で安定性補完する案を推奨します。

## 段階的な実装計画

モバイルウォレット接続機能は大きな技術チャレンジのため、**フェーズ分けした段階的アプローチ**で実装・展開することが望ましいです。以下にフェーズ毎の目標と内容を整理します。

1. **フェーズ 1: 最小実用プロトタイプ (MVP)** – \*目標: **基本的な接続と送金を可能にする\***
   **期間:** 約 1 ～ 2 週（Week 1-2）
   **内容:**

   - **CardanoConnect (CIP-45) の初期実装:** `@fabianbormann/cardano-peer-connect`ライブラリを導入し、ブラウザ側で`DAppPeerConnect`を用いたウォレット接続コードを実装します。まずは Eternl ウォレットをターゲットに、Deep Link でアプリ起動 →QR コード/識別子連携 →P2P 接続確立 →`window.cardano`への API 注入までを動作確認します。ユニバーサルリンクやスキーム URI のハンドリングも行います。
   - **UTxO/残高の取得表示:** 接続後に`api.getUtxos()`や`api.getBalance()`を呼び出し、ユーザーの残高や UTxO 一覧を取得して画面表示します。これにより同期成功をユーザーが確認できるようにします。
   - **トランザクション構築と送信（単純ケース）:** ユーザーが「全額送金（Sweep）」を行う簡易 UI を用意し、選択した UTxO をまとめて自身の別アドレスに送金する等のシンプル TX を組み立てます。`api.signTx()`でウォレットに署名要求し、ウォレットアプリで署名 →dApp に戻ったら`api.submitTx()`でネットワークにブロードキャストする一連の流れを実装します。まずは手数料計算等は固定または簡易推定で構いません。
   - **基本的エラーハンドリング:** タイムアウト（一定秒数内に接続/応答が無ければ失敗と判定）、ユーザーキャンセル時の挙動（ウォレット側で拒否/キャンセルされたらエラー表示）など、最低限のエラー処理を入れます。
   - **限定的な UI/UX:** この段階では開発者検証が主目的のため、UI は簡素で構いません。コンソールログや簡易アラートで接続状態を確認する程度とし、ユーザー向けデザインは仮置きします。

   _フェーズ 1 のゴール:_ 開発者が**Eternl モバイルウォレットでの接続実証**に成功し、ブラウザから残高参照・送金トランザクション実行ができること。これにより技術的実現性が担保されます。

2. **フェーズ 2: 機能拡張と UX 改善 (Enhanced)** – \*目標: **主要機能の完備と一般ユーザーが利用できる操作性\***
   **期間:** 約 2 ～ 3 週（Week 3-4）
   **内容:**

   - **複数ウォレット対応:** Eternl に加え、Yoroi（リリースされていれば）や他優先ウォレット（Flint, Gero 等）をサポート範囲に入れます。それぞれのウォレットアプリ起動用 Deep Link スキームや、CIP-45 非対応の場合の代替処理を組み込みます。ウォレットリスト UI を整備し、ユーザーが選択できるようにします。
   - **安定性向上:** P2P 接続の再試行ロジック、バックグラウンドからの復帰処理、複数トラッカーへの同時接続など、信頼性を高める実装を追加します。必要に応じ自前シグナリングサーバ（簡易な WebSocket ブロードキャスト）を構築し、トラッカー失敗時のフォールバックとすることも検討します。
   - **完全なトランザクション機能:** ダイアログから送金先アドレス・金額を入力して任意送金できるようにする、複数の UTxO 選択やトークン送信への対応、手数料の動的計算（API で`txBuilder.calcFee`等を利用）など、Sweep 以外の TX にも対応します。これにより dApp の機能要件（UTxO アクセスを活かした動的 TX 構築）を満たします。
   - **UI/UX 改善:** 一般ユーザーが迷わず操作できるよう、適切なモーダルやメッセージを配置します。例: 「ウォレットを起動しています…」、「接続が確立しました」、「ウォレットで署名を完了してください」等の案内を随所に表示します。操作手順を画面上にガイドする工夫（例えば接続待ちの間にアニメーションやヒントを表示）も行います。
   - **エラー・例外処理の充実:** 各種失敗ケースに対しユーザーへリトライや代替手段を提示できるようにします。例えば「接続に失敗しました。他のウォレットを試すか、Eternl アプリ内ブラウザでお試しください」のようなフォローアップメッセージを出す等。内部的にも予期せぬ例外をキャッチし、アプリがフリーズしないようにします。

   _フェーズ 2 のゴール:_ 多くのユーザーが**主要ウォレットで快適にモバイル接続機能を利用できる**状態にすること。機能面・安定性・使い勝手が向上し、限定的ながらプロダクションリリースに耐える品質となります。

3. **フェーズ 3: フル機能と将来的展開 (Full-featured)** – \*目標: **長期的な理想状態の実現と周辺機能の拡充\***
   **期間:** 将来検討（中長期継続開発）
   **内容:**

   - **高度な最適化:** 接続確立時間の短縮（WebRTC の TURN サーバ導入検討、トラッカー応答速度改善など）、モバイル特有の UX 最適化（例えば iOS でのユニバーサルリンクを用いたスムーズなアプリ間遷移）を行います。理想的にはワンタップで即ウォレット連携が完了し、ユーザーが意識せず利用できるレベルを目指します。
   - **追加ウォレット・プラットフォーム:** Tokeo など新規参入ウォレットや、今後モバイル版が出る Lace 等への対応も継続します。また可能であれば WebView（React Native や Cordova 等）環境での動作も検証し、将来的なマルチプラットフォーム展開に備えます。
   - **監視・分析ツール:** 実際の利用状況を計測し、接続成功率や所要時間、エラー頻度などのテレメトリを収集する仕組みを整えます。プライバシーに配慮しつつ匿名統計を取ることで、継続的な改善に役立てます。
   - **コミュニティフィードバック反映:** Cardano コミュニティ（開発者/ユーザー）からのフィードバックや、CIP-45 標準の改訂があれば柔軟に反映します。将来的に CIP-45 関連の新 CIP（例えば UI 統一やセキュリティアップデート）が出る可能性もあるため、常に情報をウォッチしアップグレードします。
   - **他技術との融合:** 長期的視点では、分散 ID(DID)との連携やマルチチェーン対応など、新たな要求にも応えられるよう設計拡張を検討します。例えば Cardano 以外のチェーンの WalletConnect と併用するハイブリッド dApp とする場合、当実装が障害とならないようモジュール化しておく、等です。

   _フェーズ 3 のゴール:_ モバイルウォレット接続機能が**安定・汎用・拡張可能**な形で完成し、将来的な要件変更にも耐えられる状態とすること。プロジェクトの成長に合わせ機能追加できる基盤を構築します。

各フェーズの終了後にはステークホルダーとのレビューを行い、次フェーズの計画を細かく調整します。このプログレッシブなアプローチにより、リスクを抑えつつ迅速な価値提供と将来拡張性の両立が図れる見込みです。

## リスク評価と軽減策

モバイル dApp 接続にはいくつかの**技術的リスク**および**ユーザー体験上の懸念**が存在します。ここでは主要なリスクとその緩和戦略を整理します。

- **リスク 1: P2P 接続確立失敗・不安定**
  _詳細:_ 特に初期のピア発見や WebRTC ネゴシエーションが失敗し、接続が確立できないケース。また一度接続しても途中で通信不良に陥るケース。
  _影響:_ ユーザーがウォレットを開いても dApp 側に何も起きず戸惑う、処理が途中で止まる、といった問題を引き起こします。成功率が低いとユーザーは使用を諦めてしまいます。
  _軽減策:_
  **(a) トラッカー複数指定と接続タイムアウト調整:** デフォルトで複数の WebTorrent トラッカーを設定し、どれかから応答があれば進めるようにします。一つのトラッカー問い合わせが ○ 秒応答無しなら次に切り替えるといったロジックで待ち時間を最小化します。
  **(b) TURN サーバ/自前シグナリング導入:** NAT 越え困難な環境向けに TURN サーバ（WebRTC 中継サーバ）を用意し、必要に応じ自動使用させます。カードアノ専用に構築するなら軽量な WebSocket シグナリングサーバを運用し、複数手段で接続できる冗長性を持たせます。
  **(c) 接続リトライ UI:** 1 回目失敗時に自動的に 2 回程度再試行し、それでもダメならユーザーに「再接続」ボタンを提示して手動トリガーを可能にします。ユーザーに原因を明示できない場合でも、「電波状況を確認し再度お試しください」等のガイダンスで支援します。

- **リスク 2: ウォレットアプリ非対応・バージョン相違**
  _詳細:_ ユーザーが使用しているウォレットが CIP-45 未サポート、または古いバージョンで使えない場合。例えば Yoroi リリース前や、Eternl でも旧バージョンでは機能しないなど。
  _影響:_ 接続フローを開始しても永久に成功せず、ユーザーは何が悪いか分からず混乱します。対応ウォレットの範囲を誤解される可能性も。
  _軽減策:_
  **(a) ウォレットリストの制御:** モバイル環境でウォレット一覧を表示する際、確実に使えるものに限定する。例えば初期リリースでは Eternl のみアクティブ表示し、他は「近日対応」ラベルや無効状態にする。Yoroi 実装後にアップデートで有効化する、といった段階的公開が考えられます。
  **(b) バージョンチェック:** 可能であれば Deep Link にバージョンパラメータを付与し、ウォレット側で古い場合はアップデートを促す処理を行ってもらう（これはウォレット実装次第ですが、Eternl 等に提案できるかもしれません）。難しければ Web サイトやドキュメント上で「対応するウォレットバージョン: Eternl v1.11.0 以上」等を明記しておきます。
  **(c) Fallback 案内:** 対応ウォレット以外を選んだ場合、「現在このウォレットはモバイル接続に対応していません。代わりに以下の方法をお試しください…」と案内を出します。Flint なら「Flint アプリの内蔵ブラウザから本サイトを開いて下さい」といった具体的指示を表示します。

- **リスク 3: ユーザー体験の悪化（複雑さ・待ち時間）**
  _詳細:_ モバイル特有の手順（アプリ切替や許可確認）が煩雑で、ユーザーが混乱・ストレスを感じる可能性。また接続や操作に時間がかかりイライラする可能性。
  _影響:_ エンドユーザーに敬遠され、結局 PC で使われてしまう、本来のモバイル対応の意義が薄れる恐れがあります。
  _軽減策:_
  **(a) UI での丁寧なガイド:** 一つ一つの操作に対し、「次に ◯◯ してください」という明確な指示をインタラクティブに出すようにします。例：「1. ウォレットを選択 → 2. ウォレットアプリが開いたら承認してください → 3. 承認後ここに戻って続きを行います」のように番号付きで表示する。特に初回はチュートリアル的ポップアップを出すのも有効です。
  **(b) 処理の自動化:** 可能なところは極力自動化し、ユーザー操作を減らします。例えば初回接続後はセッションを維持しておき、短時間であれば二度目以降の接続要求を省略する（ウォレットが許可済みなら即再利用できるようにする）など。トランザクション署名時も、dApp からウォレットを呼び出す Deep Link を自動送出し、ユーザーのタップを 1 回減らす工夫が考えられます。
  **(c) 待ち時間の短縮:** 接続～データ取得～署名と、一連の操作時間ができるだけ短くなるよう最適化します。トラッカー問い合わせや UTxO 取得の並列処理、UI 上のタイムアウト設定見直し等で**目標 30 秒以内**（要求仕様【technical_constraints】より）に完了する体験を目指します。進捗表示（スピナーやステータス表示）を入れてユーザーの不安を和らげる効果も狙います。

- **リスク 4: セキュリティ・プライバシー上の懸念**
  _詳細:_ P2P 通信自体の安全性や、不正な dApp が勝手に接続を試みるケース等。モバイルではユーザーの確認不足につけ込まれるリスクもあります。
  _影響:_ ユーザー資産流出等の深刻なセキュリティ事故につながる可能性。エコシステム全体の信頼低下を招きます。
  _軽減策:_
  **(a) CIP-45 のセキュリティ要件遵守:** CIP-45 では、ウォレット側で接続要求元の識別子（dApp の public key アドレス）を検証し、dApp 側でもユーザー確認ダイアログを出すことが推奨されています。実装において必ず、ウォレットでは「この dApp（識別子 X）から接続要求があります。許可しますか？」等の確認をユーザーに提示する必要があります。また dApp 側でも、例えば予期しないウォレットから接続が来た場合に拒否する処理を入れるべきです。
  **(b) データチャネルの暗号化:** WebRTC のデータチャネル通信は標準でエンドツーエンド暗号化されていますが、念のためこれを前提にアプリ設計します。トラッカーには最小限の情報（ピア公開鍵）しか流れずプライバシーは守られます。万一通信内容が傍受されても、平文の秘密情報（秘密鍵やシード）は一切流れないよう実装を確認します（CIP-30 API には秘密鍵取得メソッドは無く、署名もウォレット内処理）。
  **(c) 過剰な権限要求をしない:** モバイル OS レベルで追加の権限（位置情報やクリップボード読み取りなど）を要求するとユーザーに不信感を与えます。本機能では特別なデバイス権限は不要なため、一切求めない方針とします。但し iOS で Universal Link を使う場合はドメイン証明のセットアップが必要なので、その点は事前にアナウンスします。
  **(d) コード監査とテスト:** ライブラリ（cardano-peer-connect）任せの部分も含め、外部からの不正リクエストや想定外入力に対して堅牢か、セキュリティレビューを行います。可能であればホワイトボックステスト・ペネトレーションテストを専門家に依頼し、脆弱性が無いか確認します。

- **リスク 5: 保守の複雑さ**
  _詳細:_ 新技術の導入によりコードベースが複雑化し、将来のアップデートやバグ修正が難しくなる懸念。特に P2P やマルチ環境対応の部分はデバッグが難しい。
  _影響:_ 新たな不具合発生時に原因特定に時間を要したり、担当者でないと分からないブラックボックスになり開発負荷が増大する可能性。
  _軽減策:_
  **(a) モジュール化とドキュメント整備:** 接続ロジックは一箇所にモジュール化し、明確に境界を定義します。例えば`ConnectionManager`のようなクラスにトラッカーリスト・接続状態管理を閉じ込め、他のビジネスロジックと分離します。その上でコードに十分なコメントを付け、処理フローを設計書にまとめてチームで共有します。
  **(b) 既存ライブラリの活用と貢献:** `cardano-peer-connect`等をカスタマイズする場合も、できるだけフォークせず本家にプルリク送るなどして、ライブラリ側の改善に乗るようにします。その方が将来 CIP-45 に変更があっても対応が早く、独自改変を減らせます。
  **(c) 継続的テスト:** 後述する自動テストやモニタリングによって、問題が顕在化する前に検知・対処します。開発体制としてモバイル接続部分の知見を複数人で持つようにし、担当者依存を避けます。ドキュメント更新も都度行い、技術的負債を溜めない意識で臨みます。

以上のリスクは、あらかじめ対策を講じることで**許容可能なレベルに抑えられる**と考えます。特にユーザー体験と接続安定性に関わる部分は重点フォローし、必要であればフェーズ 2 段階で一部機能のスコープを削ってでも UX 品質を優先する判断も検討します（例えばどうしても不安定なウォレットは正式サポートを遅らせる等）。継続的な改善を前提に、まずは大きなリスクを低減した状態でリリースに臨むことが重要です。

## テストおよび検証戦略

モバイル dApp-ウォレット接続機能の品質を保証するため、**多面的なテストと検証**を行います。

**1. ユニットテストと結合テスト:**
接続ロジックやトランザクション処理の各関数についてユニットテストを整備します。特に`DAppPeerConnect`をラップした自作コード（識別子生成、QR コード生成、接続状態管理など）には、モックを使ってウォレット応答をシミュレートし、ケース別の挙動を確認します。例: _「正しい識別子を入力した場合に`onApiInject`が呼ばれる」、
「誤った識別子ならタイムアウトする」_ 等。CIP-30 API 呼び出しについても、モックウォレットオブジェクトを使い`api.getUtxos()`などの返り値処理をテストします。トランザクション組み立てでは、境界値テスト（例: UTxO が 0 件の場合や多数ある場合の挙動、ADA+マルチアセット混在時など）を行い、計算ミスや例外が出ないか確認します。結合テストとして、**擬似ウォレット**（Node.js 上で cardano-peer-connect ウォレット実装を動かすなど）とブラウザ側コードをつなぎ、エンドツーエンドでスクリプトテストすることも検討します。

**2. デバイス実機テスト:**
モバイルならではの挙動はエミュレータでは完全に再現できないため、様々な実機での検証が必要です。少なくとも以下の組み合わせを用意します:

- **iOS Safari (最新 iOS)** + Eternl iOS アプリ, Yoroi iOS アプリ（リリース後）
- **Android Chrome** + Eternl Android アプリ, Yoroi Android アプリ（リリース後）
- **旧 OS バージョン** (iOS 一世代前, Android 一世代前) との組み合わせ
- **ネットワーク環境**（WiFi 高速回線, 4G/LTE セルラー回線, 電波弱い環境）を変えてテスト

シナリオとしては、\*「接続～残高取得～送金完了」\*の基本フローを何度も繰り返すテストを行い、**成功率や所要時間を計測**します。例えば 10 回中何回成功か、平均何秒で処理完了するかなどを記録します。問題が起きた場合はウォレット側のログ（各アプリにデバッグモードがあればそれも活用）やブラウザコンソールログを確認し、原因を突き止め修正します。また、**バックグラウンド関連**のテストも行います。ウォレット起動後にすぐ戻らず 1 分放置してから戻った場合に再接続が必要か、署名中に電話がかかってきた場合に処理がどうなるか等、実際に人手で操作しながら確認します。UI についても、表示メッセージが途切れず読めるか、モーダル遷移がスムーズか、言語設定（必要なら多言語対応）など包括的にチェックします。

**3. ユーザビリティテスト（UX テスト）:**
開発メンバー以外の社内スタッフや、可能であれば少数の実ユーザーに協力いただき、**ユーザビリティテスト**を実施します。テスターに実際のスマホで接続～取引を操作してもらい、その様子を観察・ヒアリングします。理解しづらかった点、躓いた箇所、待ち時間の体感などをフィードバックしてもらい、UI メッセージの改善やガイド不足の箇所を洗い出します。例えば「どのタイミングでウォレットに戻ればいいか分からなかった」「承認後にブラウザに戻る操作を知らなかった」といった声があれば、画面上でさらに戻り方を指示する等の対応を検討します。このように**実利用シナリオに沿ったテスト**で得た改善点を反映し、ユーザー体験を磨き上げます。

**4. セキュリティテスト:**
前述のリスクでも触れた通り、セキュリティ面の検証は必須です。具体的には、**悪意あるシナリオ**を想定したテストケースを設計します。例えば:

- 不正な dApp（識別子を偽装）から接続要求が来た場合、ウォレット側が拒否するか？
- 中間者攻撃をシミュレートし、トラッカー通信や WebRTC 通信を盗聴しても機密が漏れないか？
- クライアント側で改ざんされた API（例えば`window.cardano`を不正上書き）により、署名内容を書き換えられないか？

これらは実装上容易には起こり得ませんが、ツール等でシナリオを再現しつつ確認します。必要に応じ、**外部のセキュリティ専門家**にコード監査やペンテストを依頼し、客観的な視点で脆弱性チェックを実施します。特に新しい P2P 通信部分は過去事例が少ないため、注視します。WalletConnect 等類似プロトコルで指摘された問題（Phishing サイトへの誤接続など）も参考に、可能な限り対策を講じます。

**5. ベータテスト/パイロット運用:**
フェーズ 2 終了後など適切な段階で、限定的なベータテストやパイロット運用を行います。例えば社内メンバーや親しいユーザーグループに実際の環境で使ってもらい、**実運用時の問題発見**を図ります。想定外のユーザー行動（ブラウザを途中で閉じる、他の画面に移る等）も起こり得るので、その際アプリがクラッシュしないか、接続要求が宙に残らないか等を確認します。Beta 期間中に収集した不具合報告は迅速に修正し、本番リリースまでに安定化させます。

**6. 自動テストの継続:**
リリース後も CI 上で可能な範囲の自動テストを継続します。特にユニットテストや一部のエミュレーション上での結合テストは CI パイプラインに組み込み、リグレッションを防ぎます。接続成功率などの KPI を監視するスクリプトを組むことも考えられます（例えば定期的にテスト用ウォレットで接続試行し結果をログするなど）。これにより、新たなコード変更で接続機能が壊れていないか常にチェックできます。

以上の多層的なテスト戦略によって、機能の確実性・信頼性を高めます。モバイル ×P2P という難易度の高い組み合わせですが、**徹底した検証プロセス**を経ることで、本番環境でも安心して提供できるクオリティを実現します。

## 本番導入に向けた考慮事項

最後に、開発完了後の**本番展開や運用フェーズ**で留意すべきポイントを整理します。

**1. デプロイ計画とリリース手順:**
モバイル接続機能は既存のデスクトップ向け機能に大きな変更を加える可能性があります。リリースにあたっては、まず**限定リリース**や**段階的ロールアウト**を検討します。例えば最初はベータ機能扱いとしてオプトインのユーザーだけ使えるようにする、あるいは一部機能（閲覧系のみ）に留めて公開し、徐々に取引実行まで有効化する、といった手法です。これにより重大な不具合があっても影響範囲を抑えられます。また、ドキュメントやリリースノートで「対応ウォレット一覧」「既知の制限事項（例: サポート外環境や想定できる不具合）」をユーザーに知らせ、サポート問い合わせを減らす工夫も必要です。

**2. シグナリングインフラの運用:**
本番環境で実際にどのシグナリング手段を用いるか明確に決め、必要ならそのインフラを構築・監視します。パブリックトラッカー依存とする場合でも、定期的にそれらの稼働状況をチェックし、問題が発生していないかモニタリングするようにします。自前トラッカーや TURN サーバを用意する場合は、サーバの冗長化・スケーラビリティ・セキュリティ（不正アクセス対策）を考慮し、運用ドキュメントを整備します。たとえば**接続成功率が 80%を下回った**場合にアラートを上げ原因を調査する、といった SLA 的な基準を設けることも有用です。

**3. カスタマーサポートとトラブル対応:**
ユーザーから問い合わせが来た際にサポートチームが迅速に対応できるよう、**FAQ や内部向けドキュメント**を準備します。想定問合わせ例:

- 「モバイルでウォレットと繋がりません」 → 対応ウォレットとバージョン確認、接続手順の再案内
- 「署名しようとすると固まります」 → 既知バグか、回避策（アプリ再起動等）の提示
- 「○○ ウォレットでは使えないのですか？」 → サポート予定や代替方法の説明

これらに標準回答を用意し、サポート担当と共有します。また、トラブルシュートのため**ログ収集方法**を考えておきます。ユーザーから開発チームに詳細をもらう必要がある場合、ブラウザの開発者コンソールログ取得手順や、ウォレットのログ抽出方法（もし可能なら）をユーザー向けガイドに載せます。そうすることで原因究明に役立てます。

**4. 将来のメンテナンス:**
リリース後もウォレット側のアップデートや Cardano ノード・プロトコルアップグレードに追随する必要があります。たとえば、新しい CIP-30 メソッド（マルチアカウント対応やマルチ署名対応の CIP など）が追加された場合、CIP-45 経由でもそれらを扱えるようアップデートします。幸い CIP-45 は\*\*「CIP-30 の RPC 呼び出しをそのままトンネリングする」\*\*形なので、CIP-30 準拠の変更には比較的対応しやすいはずです。具体的には、cardano-peer-connect ライブラリを最新版にアップデートし、こちらのコードも追随することで新機能を取り込めます。加えて、**ネットワーク切替やテストネット対応**も検討します。開発段階では mainnet 固定でしたが、将来的にテストネット（preprod など）でもモバイル接続テストを可能にするため、識別子スキームにネットワーク識別子を含める（CIP-13 の拡張）などの対応も視野に入れます。

**5. フォールバックプラン:**
どうしても解決できない問題が発生した場合に備え、**優雅な機能低下 (graceful degradation)** を用意します。例えば一時的にモバイル接続機能を停止するスイッチを実装しておき、緊急時にはモバイル環境ではウォレット接続ボタン自体を非表示にしてデスクトップ利用を促す等が可能です。また、ユーザー資産に関わるクリティカルなバグが見つかった場合は、その機能（例: 特定ウォレットとの組み合わせ）だけ無効化する仕組みも役立ちます。設定フラグで機能 ON/OFF を切り替えられるように実装しておくと、デプロイ無しでサーバサイドから UI を変えることも可能でしょう。万一、本当に CIP-45 方式が難しいと判明した際には、最終手段として WalletConnect 方式やアプリ内ブラウザ誘導への転換も検討しなければなりません。その場合でもユーザーに適切に周知し、安全に誘導することを忘れずに行います。

**6. コミュニティ/開発者との連携:**
Cardano はコミュニティ主導の改善が盛んなため、問題や改善点はフォーラムや GitHub で共有すると有益です。例えば CIP-45 実装中に得られた知見や、ライブラリの不具合は Fabian 氏のリポジトリ【8†】にフィードバックし、エコシステム全体で品質向上に努めます。ユーザーからの提案も積極的に取り入れ、ロードマップに反映させます。CIP-45 自体がまだ新しい提案なので、本番運用事例として得られたデータは今後の標準改訂にも役立つでしょう。

以上を踏まえ、本プロジェクトのモバイルウォレット P2P 統合は、適切な計画と対策により**高い実現性と有用性**を備えたものとなる見込みです。CIP-45 を中核に据えつつ、安全・確実でユーザーフレンドリーな実装を目指し、段階的に推進していくことを推奨します。Cardano エコシステムにおけるモバイル dApp 体験向上に大いに貢献できる取り組みとして、慎重かつ積極的に進めていきましょう。

**参考文献・出典:**

- Cardano Improvement Proposal 45: _Decentralized WebRTC dApp-Wallet Communication_
- Cardano Foundation Blog: _Cardano Ballot 2023 – CIP-45 P2P 接続の実例_
- Eternl Wallet 公式 Wiki: _CardanoConnect (CIP-45) 対応と WalletConnect の併用_
- Fabian Bormann’s _cardano-peer-connect_ ライブラリ README
- Reddit (Emurgo 関係者): _Yoroi モバイル dApp コネクタの開発状況_
- Cardano Forum: _モバイル dApp コネクタに関する Q\&A_

&#x20;“WalletConnect… requires a central signaling server… leads to a possible SPOF”
&#x20;“architecture which uses WebTorrent trackers… remove the need of this central component. After this process is completed, the data is transmitted peer-to-peer via WebRTC…”
&#x20;“CIP-45… provides a standard for decentralized P2P communications… The 2023 Ballot demonstrated… Eternl’s CIP-45 implementation to connect P2P with the Cardano Ballot.”
&#x20;“Eternl allows DApps to connect using CardanoConnect (CIP-45 - P2P) and WalletConnect! We invite all DApps to implement CardanoConnect…”
&#x20;“Eternl v2 supports… WalletConnect… CardanoConnect: a decentralized, P2P alternative to WalletConnect (CIP-45).”
&#x20;“implement all CIP-30 functions… e.g., getRewardAddresses(): … determine the reward addresses for your wallet… return resolve(rewardAddresses)”
&#x20;“clientConnectCode = dAppConnect.getAddress(); … generateQRCode… after the api was injected you can call all cip-30 function on window\.cardano…”
&#x20;“Yes, the dapp connector for mobile is very close… latter stages of development/testing… launch in the near future.”
&#x20;“not using widely used WalletConnect… taken our time to provide the safest and most elegant solution… expect it to launch this quarter.”
&#x20;“no fully fledged wallet for mobile yet… but implementations with parts of the wallet… I have some example functions… using the cardano-wallet backend… for retrieving balances, signing and submitting transactions.”
